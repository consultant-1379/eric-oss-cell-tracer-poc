ERICSSON © 2024
# Cell Tracer rApp

This repository holds the rApp code for the Cell Tracer rApp. This file provides a brief overview of the purpose of the Cell Tracer rApp
and the structure of this project. Please refer to specific documentation links for implementation details, setup/running instructions etc.

<!-- TOC -->
* [Cell Tracer rApp](#cell-tracer-rapp)
* [Cell Tracer](#cell-tracer)
  * [Related material](#related-material)
* [Implementation](#implementation)
  * [Current status of development](#current-status-of-development)
  * [Data](#data)
    * [Random event generation](#random-event-generation)
    * [ASN.1 decoding](#asn1-decoding)
  * [Secure Kafka Integration with TLS](#secure-kafka-integration-with-tls)
  * [Interaction with DCC](#interaction-with-dcc)
  * [Architecture](#architecture)
  * [Source code](#source-code)
    * [Structure](#structure)
  * [Contact Information](#contact-information)
      * [Team Members](#team-members)
  * [Glossary](#glossary)
<!-- TOC -->

> Gerrit does not render Plantuml embedded in Markdown. Please clone this git repository and open it with a suitable IDE to render the diagrams.

# Cell Tracer

Customer feedback has highlighted a clear need to explore troubleshooting capabilities at the cell and UE levels using cell traces. These insights, gathered from PM Events, provide a valuable resource for detailed troubleshooting, offering information not typically available through standard PM Counters. Customers frequently draw parallels with the comprehensive radio network tracing, visualization, and troubleshooting capabilities offered by competitors' OSS. They express a desire for similar functionalities in the E/// portfolio.

An investigation into competitors reveals a range of trace collection, visualization, and analysis options. We've confirmed that our CNOM already has the capabilities to trace UEs and initiate traces from the Core Network side. Expanding these capabilities to include RAN events in one unified system would be highly advantageous.

However, we've identified a significant gap within our E/// portfolio, particularly in the area of cell trace analysis. Currently, we lack a dedicated tool for this purpose. Typically, engineers collect cell traces using PMIC and subsequently parse them via the AMOS shell.

In response, we're taking action by developing a prototype of the Platform Cell Tracer rApp. This prototype will be showcased to various customers allowing us to collect valuable feedback and define precise requirements for the production team. The POC targets NR PM Events. The Platform Cell Tracer will serve as a troubleshooting tool exclusively and should not be used for any other purposes (e.g. large scale statistical analysis).

Please refer to [Architecture Overview](doc/Architecture_Overview/Architecture_Overview.md) for an overview of the Cell Tracer Architecture. 


## Related material

- [Cell Tracer confluence pages](https://eteamspace.internal.ericsson.com/display/PA/Platform+Cell+Tracer) 

> While the confluence pages may be useful to understand the history of the project and analysis behind it, **they are not an accurate representation of what the code does**, and they are not kept up to date!

# Implementation

Cell Tracer backend is implemented in java. The frontend leverages the OWL framework and makes use of Javascript snippets. The backend is a containerized, cloud native [Spring Boot](https://spring.io/projects/spring-boot) application. [Maven](https://maven.apache.org/) is used for the build.

## Current status of development

The Cell Tracer rApp is currently in **POC state**. It is integrated and deployable to EIC.
- The backend has good unit test coverage, but no automated E2E testing. 
- There are no automated tests for the frontend.
- Can be deployed in:
   - **Minikube** (using simulated data, for debugging, development and statistical analysis) on a PC or
   - **integrated mode** (an EIC instance connected to a real EMS).
- It is **not** vetted for 3PP licenses so not ready for external deployment
- Kafka is not working in secure mode yet

## Data

Cell Tracer rApp works on real (from EIC event bus) or simulated data (generated by the rApp itself). Since Cell Tracer rApp makes use of CM and topology data to filter events the NCI and GNodebID in the events has to match the corresponding CM data available in EIC. This is obviously not a problem for a real deployment but it requires attention for a test environment.

### Random event generation

The random event generation can be controlled using the following helm values:
```
--set "configuration.app[1]"="app.generator.events.enabled=true" 
```
event rate - this example will generate one event per second:
```
--set "configuration.app[2]"="app.generator.events.rate=* * * * * *"
```
### ASN.1 decoding

Cell tracer can (optionally) decode ASN.1 data from the events into a human-readable format. The decoding is performed by a sidecar container 
([eric-oss-asn1-decoder-poc](https://gerrit.ericsson.se/plugins/gitiles/OSS/com.ericsson.oss.apps/eric-oss-asn1-decoder-poc/+/refs/heads/master)) 
and enabled by the following helm value:

```
--set "configuration.app[3]"="app.asn1.decoder.enabled=true"
```

The sidecar image should be available in the EIC cluster for the Cell Tracer rApp to decode ASN.1 data.  

## Secure Kafka Integration with TLS
This part of the guide, provides instructions for securely integrating Kafka with TLS encryption and OAuth authentication of rApp on a Kubernetes cluster.

1. Firstly, ensure that the required SSL certificates are available as Kubernetes secrets (iam-cacert-secret and kafka-cacert-secret). These secrets contain the CA certificates for IAM and Kafka.
2. To enable the security settings, set the following parameters in the [application.yaml](eric-oss-cell-tracer-poc-app/src/main/resources/application.yaml):
    ```
    --set "configuration.app[4]"="rapp-sdk.kafka.oauth=true"
    ```
3. The JKS files for kafka security are created automatically by the generate_jks.sh script via Dockerfile. The location of the truststore file, password, and related fields are also configurable during instantiation phase according to the [values.yaml](charts/eric-oss-cell-tracer-poc/values.yaml) file.
    ```
    configuration.kafka.oauth=true
    rappSdk.kafka.securityProtocol=SASL_SSL
    spring.kafka.properties.sasl.jaas.config=org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required oauth.token.endpoint.uri="${BASE_URL:}/auth/realms/${TENANT:master}/protocol/openid-connect/token" oauth.client.id="${CLIENT_ID:}" oauth.client.secret="${CLIENT_SECRET:}" oauth.ssl.truststore.location="${TRUST_STORE_LOCATION:}/truststore.jks" oauth.ssl.truststore.password="${TRUST_STORE_PASSWORD:}";
    kafkaSecretName=kafka-cacert-secret
    kafkaSecretKey=tls.crt
    kafkaCaCertMountPath=/mnt/kafkaCerts
    ```
4. The location of the JKS file and password are pass through via as an environmental variables during the [route creation](charts/eric-oss-cell-tracer-poc/templates/hooks/create_route.yaml) and [deployment](charts/eric-oss-cell-tracer-poc/templates/deployment.yaml).

## Interaction with DCC

The rApp can ignore EIC subscriptions by turning off the interaction with DCC. This can be done for the purpose of testing in an isolated environment and is
controlled by the ```configuration.dcc.enabled``` parameter in [helm values file](charts/eric-oss-cell-tracer-poc/values.yaml). If the data is generated it contains random events from the list of [supported event types](charts/eric-oss-cell-tracer-poc/resources/nr_event_id_class.csv) and random nodes from [the allowed nodes list](charts/eric-oss-cell-tracer-poc/resources/allowed_nodes.csv). This can be used for demo purpose.

## Architecture

Please refer to the [EIAP architecture documentation](https://oss-architecture.seli.wh.rnd.internal.ericsson.com/products/current/EIC/eic.html) for a general view of where an rApp fits in EIC

## Source code

The Cell Tracer rApp has been implemented using the Spring Boot [Microservice Chassis](https://gerrit.ericsson.se/plugins/gitiles/OSS/com.ericsson.oss.de/microservice-chassis/+/refs/heads/master/README.md). 
The code has been updated to Java 17 and Spring boot 3.


### Structure
The Cell Tracer rApp is split in four maven modules:
- [eric-oss-topology-client](eric-oss-topology-client) hosts a REST client for the required calls to CTS.
- [eric-oss-cell-tracer-poc-api](eric-oss-cell-tracer-poc-api) hosts the application REST endpoints and is based on [Openapi generator](https://openapi-generator.tech/). 
Please note the generated code is stored in the target folder, so you may have to adjust your IDE settings to make it visible. Also, the [openAPI definition](ci/csar_template/OtherDefinitions/ASD/eric-oss-cell-tracer-poc-openapi.yaml) is stored in the ci folder, and copied by the Maven build to avoid duplication.  
- [eric-oss-cell-tracer-poc-app](eric-oss-cell-tracer-poc-app) hosts the application code and depends on [eric-oss-cell-tracer-poc-api](eric-oss-cell-tracer-poc-api)
- [eric-oss-cell-tracer-poc-grpc](eric-oss-cell-tracer-poc-grpc) hosts the grpc client generation code for ASN.1 decoding

All code is compiled to target directories and follow a standard java code structure.


The [gui](gui) hosts the UI OWL code. 

The [ci](ci) folder provides information for pipeline execution and customization.

The [charts](charts) folder hosts the helm charts and templates for rApp deployment in EIC,
and dependencies required to deploy in non-EIC environment for security scanning.  

```
.
├── charts
│   ├── eric-oss-cell-tracer-poc
│   └── eric-oss-cell-tracer-poc-deps
├── ci
├── doc
├── eric-oss-cell-tracer-poc-api
│   ├── src
│   └── target
├── eric-oss-cell-tracer-poc-app
│   ├── src
│   └── target
├── eric-oss-cell-tracer-poc-grpc
│   └── target
├── eric-oss-topology-client
│   ├── src
│   └── target
└── gui
    ├── app
    ├── auto
    ├── credential
    ├── role
    ├── storage
    ├── system
    ├── user
    └── widget
```

## Contact Information
#### Team Members

"Guardians" for this project can be reached at [rApp prototype team](mailto:IDUN_rAppPrototypeTeam@ericsson.onmicrosoft.com). 
We apply an Apache-like model to contributions, that is - unless any team member has a major issue with the change we are very happy to take it onboard.  


## Glossary

Here you can find a full 5G [glossary](https://cpistore.internal.ericsson.com/elex?LI=EN/LZN7931071*&FN=1_0033-HSC10550_1-1Uen.*.html&HT=CHAPTER3&DT=Glossary+of+Terms+and+Acronyms).